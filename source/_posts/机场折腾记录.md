---
title: 机场折腾记录
date: 2025-02-20 13:55:14
tags:
    - "emby"
    - "机场"
categories: "技术分享"
keywords: "折腾全记录"
description: 因为最近 mf 跑路，找不到合适的服务商，偶然发现 fac 和好鸭送 emby，去看了一下，确实还不错，紧接着后面一系列的折腾就来了。
top_img: 'https://cdn.jsdelivr.net/gh/tzzzzzzzzzzz/blog-img@main/20250220140131842.png'
cover: 'https://cdn.jsdelivr.net/gh/tzzzzzzzzzzz/blog-img@main/20250220140131842.png'
---
## 机场方案

| 机场 | emby                                | 流量    | 价格                        | 网络要求       | 客户端要求        |                                    |
| ---- | ----------------------------------- | ------- | --------------------------- | -------------- | ----------------- | ---------------------------------- |
| -    | hxd+hxd porn🔞                       | -       | 8.8/月                      | 禁日本         | 禁 infuse、vidhub | 偶尔开注，公费服，无需保号         |
| -    | 垃圾影音                            | -       | 111.1/永久                  | 禁日本         | 禁 vidhub         | 永久，公费数量固定，公益充电 111.1 |
| 好鸭 | 地平线 垃圾影音 卷毛鼠              | 100G/月 | 12/月                       | 禁日本、禁美国 | 禁 vidhub         | 机场状态正常                       |
| FAC  | peach 垃圾影音 pilipili misty porn🔞 | 30G/月  | 47.99/年 4/月               | 强制直连       | 禁 infuse、vidhub | 机场状态正常                       |
| -    | ACE                                 | -       | 3.21/月                     | 无要求         | 无要求            | 开注，无保号                       |
|      |                                     | 130G/月 | 28.01/月 28.01*12=336.12/年 |                |                   |                                    |

## 订阅的转换

### 后端subconverter部署

因为我还有一个自建的 xray 的服务在搬瓦工上，在家里的软路由上还需要进行订阅链接的转换，所以在 nas 里部署了一个subconverter 的服务。

Docker部署方式非常简单：

```yaml
docker run -d --restart=always -p 25500:25500 tindy2013/subconverter:latest
```

参考这个[使用手册](https://github.com/tindy2013/subconverter/blob/master/README-cn.md)，基本上就能满足基本使用了。

### 前端subconverter-web部署

如果需要可视化的链接转换页面，也是一条 docker 命令就能搞定。

```yaml
docker run -d -p 58080:80 --restart always --name subweb careywong/subweb:latest
```

### 各平台使用

#### openclash

在openwrt 的 openclash 中只要指定订阅转换的地址是subconverter 部署的后端地址就可以了。

![](https://cdn.jsdelivr.net/gh/tzzzzzzzzzzz/blog-img@main/20250220141903088.png)

#### windows 和 macOS

基于 all-in-one 的原则，全平台尽可能都使用 clash 语法规则，方便迁移和备份，所以我在两端使用的都是 [Clash Verge](https://www.clashverge.dev/)。

通过subconverter 转换生成的链接直接导入Clash Verge 中就能使用了，这里还是非常简单的。

难点在于这几个 emby 服务的网络限制，从上面看，目前 fac强制直连走 DRIECT还比较简单，直接在规则中进行添加即可，复杂是好鸭的卷毛鼠限制了不能使用日本和美国节点，但是目前普通的 clash 规则只能指定某域名使用的节点的范围不能反向指定不走的节点范围。

使用了很多的 AI 工具，包括 deepseek、通义、谷歌 ai，都没有写成功这个脚本，没想到是昨天老马新发布的 X-AI 最新的 Grok3 给写明白了。

##### **在Clash Verge 中的全局脚本中实现某域名不经过某些节点，并且按照节点的名称进行筛选。**

```javascript
// Define main function (script entry)

// 国内DNS服务器
const domesticNameservers = [
  "https://dns.alidns.com/dns-query", // 阿里云公共DNS
  "https://doh.pub/dns-query", // 腾讯DNSPod
  "https://doh.360.cn/dns-query" // 360安全DNS
];
// 国外DNS服务器
const foreignNameservers = [
  "https://1.1.1.1/dns-query", // Cloudflare(主)
  "https://1.0.0.1/dns-query", // Cloudflare(备)
  "https://208.67.222.222/dns-query", // OpenDNS(主)
  "https://208.67.220.220/dns-query", // OpenDNS(备)
  "https://194.242.2.2/dns-query", // Mullvad(主)
  "https://194.242.2.3/dns-query" // Mullvad(备)
];
// DNS配置
const dnsConfig = {
  "enable": true,
  "listen": "0.0.0.0:1053",
  "ipv6": true,
  "use-system-hosts": false,
  "cache-algorithm": "arc",
  "enhanced-mode": "fake-ip",
  "fake-ip-range": "198.18.0.1/16",
  "fake-ip-filter": [
    // 本地主机/设备
    "+.lan",
    "+.local",
    // Windows网络出现小地球图标
    "+.msftconnecttest.com",
    "+.msftncsi.com",
    // QQ快速登录检测失败
    "localhost.ptlogin2.qq.com",
    "localhost.sec.qq.com",
    // 微信快速登录检测失败
    "localhost.work.weixin.qq.com"
  ],
  "default-nameserver": ["223.5.5.5", "119.29.29.29", "1.1.1.1", "8.8.8.8"],
  "nameserver": [...domesticNameservers, ...foreignNameservers],
  "proxy-server-nameserver": [...domesticNameservers, ...foreignNameservers],
  "nameserver-policy": {
    "geosite:private,cn,geolocation-cn": domesticNameservers,
    "geosite:google,youtube,telegram,gfw,geolocation-!cn": foreignNameservers,
  }
};


// 前置规则，普通的全局规则写法
const prependRules = [
  // lan ip
  // "IP-CIDR,172.172.0.0/32,DIRECT,no-resolve",
  // "IP-CIDR,192.168.0.0/32,DIRECT,no-resolve",
  // "IP-CIDR,192.192.0.0/32,DIRECT,no-resolve",
  // "IP-CIDR,127.0.0.0/32,DIRECT,no-resolve",
  // xxx
  "DOMAIN-KEYWORD,****,DIRECT",
  // "DOMAIN-SUFFIX,xxx.com,DIRECT",
];
// function main() {
//   config["dns"] = dnsConfig;
//   config.rules = prependRules.concat(config.rules);
//   return config;
// }

function main(config) {
  // 获取所有代理节点
  const proxies = config.proxies || [];
  
  // 过滤掉名称中包含 🇺🇸 或 🇯🇵 的节点，规则写法
  const filteredProxies = proxies
    .filter(proxy => !proxy.name.includes('🇺🇸') && !proxy.name.includes('🇯🇵'))
    .map(proxy => proxy.name);

  // 如果没有符合条件的节点，抛出错误
  if (filteredProxies.length === 0) {
    throw new Error('没有找到不含 🇺🇸 和 🇯🇵 的可用节点');
  }

  // 定义新规则之前，先把前置规则prependRules扔进去
  config["dns"] = dnsConfig;
  config.rules = prependRules.concat(config.rules);

  // 定义新的规则
  const newRules = [
    // 匹配 nice.com 域名后缀，使用过滤后的节点，适配所有规则写法，灵活运用
    `DOMAIN-SUFFIX,****.com,AUTO-NICE`,
    // 保留原有规则
    ...config.rules
  ];

  // 添加一个自动选择组，只包含不含 🇺🇸 和 🇯🇵 的节点
  const autoGroup = {
    name: 'AUTO-NICE',
    type: 'url-test', // 自动选择类型
    proxies: filteredProxies,
    url: 'http://www.gstatic.com/generate_204', // 测试延迟的 URL
    interval: 300, // 测试间隔（秒）
    tolerance: 50 // 延迟容差（毫秒）
  };

  // 更新 proxy-groups，添加新的自动选择组
  config['proxy-groups'] = config['proxy-groups'] || [];
  config['proxy-groups'].push(autoGroup);
  
  // 更新规则
  config.rules = newRules;

  return config;
}
```

**2025 年 2 月 27 日的补充**
昨天发现了新的方式来解决这个问题，原来subconverter是支持外部订阅模板转换的，结合了一个 YouTuber 的介绍，完美的解决了定向分流和更多高级玩法，真是每天都在学新东西啊。

https://www.youtube.com/watch?v=D841V_xgykg

### 其他平台

目前无安卓手机，也没有 linux 需求，但是万变不离其宗。